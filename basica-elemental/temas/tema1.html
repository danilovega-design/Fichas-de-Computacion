<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tema 1 - Guía Completa de Excel y Power BI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f5f5f5; scroll-behavior: smooth; }
        .logo-texto { display: flex; align-items: center; justify-content: center; flex-wrap: wrap; padding: 20px; background-color: #350a06; }
        .logo-texto img { height: 80px; margin-right: 20px; }
        .texto-header { display: flex; flex-direction: column; align-items: center; color: white; }
        .texto-header h1 { font-size: 28px; }
        .texto-header p { font-size: 16px; margin-top: 5px; }
        main { flex: 1; padding: 30px; max-width: 1200px; margin: 0 auto; }
        .contenido { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); margin-bottom: 20px; }
        footer { background-color: #350a06; color: white; text-align: center; padding: 20px; margin-top: 20px; }
        
        /* Estilos combinados de la guía anterior */
        .code-block {
            background-color: #f4f4f5; /* zinc-100 */
            border-radius: 0.5rem;
            padding: 1rem;
            font-family: monospace;
            color: #18181b; /* zinc-900 */
            border: 1px solid #e4e4e7; /* zinc-200 */
            overflow-x: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border-left-color: #09f;
            animation: spin 1s ease infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @media (max-width: 768px) { 
            .logo-texto { flex-direction: column; }
            .logo-texto img { margin-bottom: 10px; height: 60px; }
            .texto-header h1 { font-size: 22px; }
            .texto-header p { font-size: 14px; }
        }
    </style>
</head>
<body>

    <!-- HEADER -->
    <header class="logo-texto">
        <img src="../logo.png" alt="Logo de la institución">
        <div class="texto-header">
            <h1>Tema 1 - Introducción a Excel y Power BI</h1>
            <p>Aprende los conceptos básicos y avanzados</p>
        </div>
    </header>

    <!-- CONTENIDO -->
    <main>
        <!-- Bloque de información -->
        <div class="contenido">
            <h2 class="text-2xl font-bold mb-4">Bienvenida</h2>
            <p class="mb-4">Has llegado a la guía completa de Excel y Power BI. En las siguientes secciones, profundizaremos en las herramientas más importantes para el análisis de datos, desde las funciones condicionales hasta la visualización interactiva.</p>
            <ul class="list-disc list-inside mb-4">
                <li>Domina las fórmulas clave de Excel.</li>
                <li>Transforma datos en decisiones con Power BI.</li>
                <li>Utiliza la IA para acelerar tu trabajo.</li>
            </ul>
        </div>

        <!-- CONTENIDO DE EXCEL INSERTADO AQUÍ -->
        <div class="contenido">
            <h2 class="text-3xl font-bold mb-6 pb-2 border-b-2 border-blue-500 text-gray-800">Dominando Microsoft Excel</h2>

            <!-- Subsection: Conditional Functions -->
            <div class="bg-white p-8 rounded-xl shadow-lg mb-8">
                <h3 class="text-2xl font-semibold mb-4 text-blue-700">1. Funciones Condicionales en Excel: Tomando Decisiones con Datos</h3>
                <p class="mb-6 text-gray-600">Las funciones condicionales son una de las herramientas más potentes de Excel. Permiten automatizar tareas y tomar decisiones lógicas, ejecutando una acción si una condición se cumple y otra si no se cumple. Son la base para crear hojas de cálculo inteligentes y dinámicas.</p>
                <div class="mb-6">
                    <h4 class="text-xl font-medium mb-2">La Función SI (IF)</h4>
                    <p class="mb-3">Es la función condicional fundamental. Evalúa una condición y devuelve un valor si es verdadera y otro si es falsa.</p>
                    <p class="font-semibold">Sintaxis:</p>
                    <div class="code-block mb-3">=SI(prueba_lógica, valor_si_verdadero, valor_si_falso)</div>
                    <p class="font-semibold">Ejemplo Práctico: Calificaciones</p>
                    <p class="mb-3">Imagina que en la celda A2 tienes la nota de un examen. Quieres que en B2 aparezca "Aprobado" si la nota es mayor o igual a 7, y "Reprobado" en caso contrario.</p>
                    <div class="code-block">=SI(A2>=7, "Aprobado", "Reprobado")</div>
                </div>
                <div class="mb-6">
                    <h4 class="text-xl font-medium mb-2">Combinando Condiciones con Y (AND) y O (OR)</h4>
                    <p class="mb-3">Puedes anidar las funciones Y y O dentro de un SI para evaluar múltiples condiciones.</p>
                    <p class="font-semibold">Ejemplo con Y: Bono por Desempeño</p>
                    <p class="mb-3">Un empleado recibe un bono si sus ventas (A2) son mayores a $10,000 Y su asistencia (B2) es del 100%.</p>
                    <div class="code-block">=SI(Y(A2>10000, B2="100%"), "Recibe Bono", "No recibe Bono")</div>
                </div>
                <div class="mb-6">
                    <h4 class="text-xl font-medium mb-2">Contar y Sumar bajo Criterios: CONTAR.SI y SUMAR.SI</h4>
                    <p class="font-semibold">Ejemplo con SUMAR.SI: Ventas por Categoría</p>
                    <p class="mb-3">Quieres sumar todas las ventas de la categoría "Electrónica" (Columna A) usando los montos de la Columna B.</p>
                    <div class="code-block">=SUMAR.SI(A2:A100, "Electrónica", B2:B100)</div>
                </div>
            </div>

            <!-- GEMINI API: Excel Formula Generator -->
            <div class="bg-white p-8 rounded-xl shadow-lg mb-8 border-t-4 border-blue-400">
                <h3 class="text-2xl font-semibold mb-4 text-blue-700">✨ Asistente de Fórmulas con IA</h3>
                <p class="mb-4 text-gray-600">Describe lo que necesitas hacer y la IA generará la fórmula de Excel por ti. Por ejemplo: "sumar los valores en la columna B si la celda correspondiente en la columna A dice 'Vendido'".</p>
                <textarea id="excel-prompt" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition" rows="3" placeholder="Escribe tu petición aquí..."></textarea>
                <button id="excel-submit" class="mt-4 bg-blue-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-blue-700 transition w-full sm:w-auto flex items-center justify-center">Generar Fórmula</button>
                <div id="excel-loading" class="hidden mt-4 flex justify-center"><div class="spinner"></div></div>
                <div id="excel-output" class="mt-6 hidden">
                    <h4 class="text-lg font-semibold mb-2">Fórmula Sugerida:</h4>
                    <div id="excel-result-code" class="code-block"></div>
                </div>
            </div>
        </div>

        <!-- CONTENIDO DE POWER BI INSERTADO AQUÍ -->
        <div class="contenido">
            <h2 class="text-3xl font-bold mb-6 pb-2 border-b-2 border-green-500 text-gray-800">Power BI Profesional</h2>
            <div class="bg-white p-8 rounded-xl shadow-lg mb-8">
                <h3 class="text-2xl font-semibold mb-4 text-green-700">Transformando Datos en Decisiones con Power BI</h3>
                <p class="mb-6 text-gray-600">Power BI es una plataforma de inteligencia de negocios (Business Intelligence) de Microsoft. Su objetivo es proporcionar visualizaciones de datos interactivas y capacidades de BI con una interfaz lo suficientemente simple como para que los usuarios finales puedan crear sus propios informes y paneles.</p>
                <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <div class="bg-gray-50 p-6 rounded-lg border border-gray-200"><h4 class="text-lg font-semibold text-gray-800 mb-2">Conexión a Datos</h4><p class="text-gray-600">Power BI puede conectarse a cientos de fuentes de datos, desde un simple archivo de Excel hasta bases de datos complejas en la nube (SQL, Azure) o servicios en línea.</p></div>
                    <div class="bg-gray-50 p-6 rounded-lg border border-gray-200"><h4 class="text-lg font-semibold text-gray-800 mb-2">Transformación y Modelado</h4><p class="text-gray-600">Con el Editor de Power Query, puedes limpiar, transformar y dar forma a tus datos para crear modelos y relaciones para análisis más profundos.</p></div>
                    <div class="bg-gray-50 p-6 rounded-lg border border-gray-200"><h4 class="text-lg font-semibold text-gray-800 mb-2">Visualización Interactiva</h4><p class="text-gray-600">El corazón de Power BI. Crea informes y paneles (dashboards) interactivos arrastrando y soltando elementos que se actualizan en tiempo real.</p></div>
                </div>
            </div>

            <!-- GEMINI API: Power BI DAX Generator -->
            <div class="bg-white p-8 rounded-xl shadow-lg border-t-4 border-green-400">
                <h3 class="text-2xl font-semibold mb-4 text-green-700">✨ Asistente de Medidas DAX con IA</h3>
                <p class="mb-4 text-gray-600">Describe el cálculo que necesitas en Power BI y la IA generará la medida DAX. Por ejemplo: "calcular el total de ventas para el año 2023".</p>
                <textarea id="dax-prompt" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 transition" rows="3" placeholder="Escribe tu petición aquí..."></textarea>
                <button id="dax-submit" class="mt-4 bg-green-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-green-700 transition w-full sm:w-auto flex items-center justify-center">Generar Medida DAX</button>
                <div id="dax-loading" class="hidden mt-4 flex justify-center"><div class="spinner" style="border-left-color: #16a34a;"></div></div>
                <div id="dax-output" class="mt-6 hidden">
                    <h4 class="text-lg font-semibold mb-2">Medida DAX Sugerida:</h4>
                    <div id="dax-result-code" class="code-block"></div>
                </div>
            </div>
        </div>
    </main>

    <!-- FOOTER -->
    <footer>
        <a href="../index.html" style="color:white; text-decoration:none;">← Volver al menú principal</a>
    </footer>

    <script type="module">
        const excelSubmitButton = document.getElementById('excel-submit');
        const excelPromptTextarea = document.getElementById('excel-prompt');
        const excelLoadingDiv = document.getElementById('excel-loading');
        const excelOutputDiv = document.getElementById('excel-output');
        const excelResultCode = document.getElementById('excel-result-code');

        const daxSubmitButton = document.getElementById('dax-submit');
        const daxPromptTextarea = document.getElementById('dax-prompt');
        const daxLoadingDiv = document.getElementById('dax-loading');
        const daxOutputDiv = document.getElementById('dax-output');
        const daxResultCode = document.getElementById('dax-result-code');

        // IMPORTANTE: Reemplaza el siguiente texto con tu propia clave API de Google AI Studio.
        const apiKey = "AQUÍ_VA_TU_CLAVE_API";

        async function callGeminiAPI(prompt, systemInstruction, loadingElement, outputContainer, outputElement) {
            if (apiKey === "AQUÍ_VA_TU_CLAVE_API") {
                outputContainer.style.display = 'block';
                outputElement.textContent = 'Error: Por favor, introduce una clave API válida en el código fuente para activar esta función.';
                return;
            }

            loadingElement.style.display = 'flex';
            outputContainer.style.display = 'none';
            
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
            const payload = {
                contents: [{ parts: [{ text: prompt }] }],
                systemInstruction: { parts: [{ text: systemInstruction }] }
            };

            let response;
            let retries = 3;
            let delay = 1000;

            for (let i = 0; i < retries; i++) {
                try {
                    response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    if (response.ok) break;
                } catch (error) {
                    console.error('Fetch error:', error);
                }
                if (i < retries - 1) await new Promise(resolve => setTimeout(resolve, delay *= 2));
            }
            
            loadingElement.style.display = 'none';

            if (!response || !response.ok) {
                outputContainer.style.display = 'block';
                outputElement.textContent = 'Hubo un error al contactar la IA. Verifica tu clave API y la conexión a internet.';
                return;
            }

            try {
                const result = await response.json();
                const candidate = result.candidates?.[0];
                if (candidate && candidate.content?.parts?.[0]?.text) {
                    let generatedText = candidate.content.parts[0].text.trim();
                    generatedText = generatedText.replace(/^```(excel|dax)?\n?/, '').replace(/\n?```$/, '');
                    outputElement.textContent = generatedText;
                    outputContainer.style.display = 'block';
                } else {
                    throw new Error("Respuesta inválida de la API.");
                }
            } catch (error) {
                console.error('Error parsing response:', error);
                outputContainer.style.display = 'block';
                outputElement.textContent = 'No se pudo procesar la respuesta de la IA. Inténtalo de nuevo.';
            }
        }

        excelSubmitButton.addEventListener('click', () => {
            const prompt = excelPromptTextarea.value;
            if (!prompt) return;
            const systemInstruction = "Eres un experto en Microsoft Excel. Convierte la siguiente petición en una fórmula de Excel. Responde únicamente con la fórmula. No incluyas explicaciones adicionales, texto introductorio, ni el formato de código de markdown ```excel.";
            callGeminiAPI(prompt, systemInstruction, excelLoadingDiv, excelOutputDiv, excelResultCode);
        });

        daxSubmitButton.addEventListener('click', () => {
            const prompt = daxPromptTextarea.value;
            if (!prompt) return;
            const systemInstruction = "Eres un experto en Power BI y DAX. Convierte la siguiente petición en una medida DAX. Responde únicamente con el código DAX. No incluyas explicaciones adicionales, texto introductorio, ni el formato de código de markdown ```dax.";
            callGeminiAPI(prompt, systemInstruction, daxLoadingDiv, daxOutputDiv, daxResultCode);
        });
    </script>

</body>
</html>
